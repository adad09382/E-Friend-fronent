import{p as L,m as K,a as Q,g as E,u as R,c as a,b as ee,d as te,e as ae,f as oe,h as le,t as z,i as se,j as ne,k as re,l as ue,n as ie,s as C,o as m,q as ce,V as de,r as $,v as H,w as ve,x as O,y as me,z as D,A as ge,B as fe,C as he,D as pe,E as be,F as ye,G as _e,H as q,I as Ve,J as ke,K as P,L as xe,M as Se,N as Te,O as Be,P as we,Q as Ce,R as d,S as B,T as i,U as S,W as _,X as w,Y as k,Z as Ie,_ as Y,$ as I,a0 as F,a1 as M,a2 as U,a3 as Pe,a4 as j,a5 as G,a6 as Ne,a7 as Ae,a8 as Le}from"./index-af9d4350.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Re,a as He}from"./VNavigationDrawer-d7305da7.js";const W=L({text:String,...K(),...Q()},"VToolbarTitle"),X=E()({name:"VToolbarTitle",props:W(),setup(e,v){let{slots:t}=v;return R(()=>{const n=!!(t.default||t.text||e.text);return a(e.tag,{class:["v-toolbar-title",e.class],style:e.style},{default:()=>{var s;return[n&&a("div",{class:"v-toolbar-title__placeholder"},[t.text?t.text():e.text,(s=t.default)==null?void 0:s.call(t)])]}})}),{}}}),De=[null,"prominent","default","comfortable","compact"],Z=L({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>De.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...ee(),...K(),...te(),...ae(),...Q({tag:"header"}),...oe()},"VToolbar"),J=E()({name:"VToolbar",props:Z(),setup(e,v){var o;let{slots:t}=v;const{backgroundColorClasses:n,backgroundColorStyles:s}=le(z(e,"color")),{borderClasses:l}=se(e),{elevationClasses:b}=ne(e),{roundedClasses:g}=re(e),{themeClasses:p}=ue(e),{rtlClasses:y}=ie(),c=C(!!(e.extended||(o=t.extension)!=null&&o.call(t))),V=m(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),f=m(()=>c.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return ce({VBtn:{variant:"text"}}),R(()=>{var u;const h=!!(e.title||t.title),x=!!(t.image||e.image),r=(u=t.extension)==null?void 0:u.call(t);return c.value=!!(e.extended||r),a(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},n.value,l.value,b.value,g.value,p.value,y.value,e.class],style:[s.value,e.style]},{default:()=>[x&&a("div",{key:"image",class:"v-toolbar__image"},[t.image?a($,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},t.image):a(de,{key:"image-img",cover:!0,src:e.image},null)]),a($,{defaults:{VTabs:{height:H(V.value)}}},{default:()=>{var T,N,A;return[a("div",{class:"v-toolbar__content",style:{height:H(V.value)}},[t.prepend&&a("div",{class:"v-toolbar__prepend"},[(T=t.prepend)==null?void 0:T.call(t)]),h&&a(X,{key:"title",text:e.title},{text:t.title}),(N=t.default)==null?void 0:N.call(t),t.append&&a("div",{class:"v-toolbar__append"},[(A=t.append)==null?void 0:A.call(t)])])]}}),a($,{defaults:{VTabs:{height:H(f.value)}}},{default:()=>[a(ve,null,{default:()=>[c.value&&a("div",{class:"v-toolbar__extension",style:{height:H(f.value)}},[r])]})]})]})}),{contentHeight:V,extensionHeight:f}}}),Fe=L({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function Me(e){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:t}=v;let n=0;const s=O(null),l=C(0),b=C(0),g=C(0),p=C(!1),y=C(!1),c=m(()=>Number(e.scrollThreshold)),V=m(()=>me((c.value-l.value)/c.value||0)),f=()=>{const o=s.value;!o||t&&!t.value||(n=l.value,l.value="window"in o?o.pageYOffset:o.scrollTop,y.value=l.value<n,g.value=Math.abs(l.value-c.value))};return D(y,()=>{b.value=b.value||l.value}),D(p,()=>{b.value=0}),ge(()=>{D(()=>e.scrollTarget,o=>{var x;const h=o?document.querySelector(o):window;h&&h!==s.value&&((x=s.value)==null||x.removeEventListener("scroll",f),s.value=h,s.value.addEventListener("scroll",f,{passive:!0}))},{immediate:!0})}),fe(()=>{var o;(o=s.value)==null||o.removeEventListener("scroll",f)}),t&&D(t,f,{immediate:!0}),{scrollThreshold:c,currentScroll:l,currentThreshold:g,isScrollActive:p,scrollRatio:V,isScrollingUp:y,savedScroll:b}}const Ue=L({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Z(),...he(),...Fe(),height:{type:[Number,String],default:64}},"VAppBar"),$e=E()({name:"VAppBar",props:Ue(),emits:{"update:modelValue":e=>!0},setup(e,v){let{slots:t}=v;const n=O(),s=pe(e,"modelValue"),l=m(()=>{var T;const u=new Set(((T=e.scrollBehavior)==null?void 0:T.split(" "))??[]);return{hide:u.has("hide"),inverted:u.has("inverted"),collapse:u.has("collapse"),elevate:u.has("elevate"),fadeImage:u.has("fade-image")}}),b=m(()=>{const u=l.value;return u.hide||u.inverted||u.collapse||u.elevate||u.fadeImage||!s.value}),{currentScroll:g,scrollThreshold:p,isScrollingUp:y,scrollRatio:c}=Me(e,{canScroll:b}),V=m(()=>e.collapse||l.value.collapse&&(l.value.inverted?c.value>0:c.value===0)),f=m(()=>e.flat||l.value.elevate&&(l.value.inverted?g.value>0:g.value===0)),o=m(()=>l.value.fadeImage?l.value.inverted?1-c.value:c.value:void 0),h=m(()=>{var N,A;if(l.value.hide&&l.value.inverted)return 0;const u=((N=n.value)==null?void 0:N.contentHeight)??0,T=((A=n.value)==null?void 0:A.extensionHeight)??0;return u+T});be(m(()=>!!e.scrollBehavior),()=>{Ve(()=>{l.value.hide?l.value.inverted?s.value=g.value>p.value:s.value=y.value||g.value<p.value:s.value=!0})});const{ssrBootStyles:x}=ye(),{layoutItemStyles:r}=_e({id:e.name,order:m(()=>parseInt(e.order,10)),position:z(e,"location"),layoutSize:h,elementSize:C(void 0),active:s,absolute:z(e,"absolute")});return R(()=>{const[u]=J.filterProps(e);return a(J,q({ref:n,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...r.value,"--v-toolbar-image-opacity":o.value,height:void 0,...x.value},e.style]},u,{collapse:V.value,flat:f.value}),t)}),{}}}),ze=L({...ke({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),Oe=E()({name:"VAppBarNavIcon",props:ze(),setup(e,v){let{slots:t}=v;return R(()=>a(P,q(e,{class:["v-app-bar-nav-icon"]}),t)),{}}}),qe=E()({name:"VAppBarTitle",props:W(),setup(e,v){let{slots:t}=v;return R(()=>a(X,q(e,{class:"v-app-bar-title"}),t)),{}}});const Ye=e=>(Ne("data-v-d8551667"),e=e(),Ae(),e),je=Ye(()=>Le("span",{class:"web-subtitle"},null,-1)),Ge={__name:"FrontLayout",setup(e){const v=xe(),t=Se(),{isLogin:n,isAdmin:s}=Te(t),l=Be(),{mobile:b}=we(),g=m(()=>b.value),p=O(!1),y=m(()=>[{to:"/",text:"HOME",icon:"mdi-home",show:!0},{to:"/topic",text:"探索話題",icon:"mdi-message",show:n.value},{to:"/news",text:"新聞話題",icon:"mdi-newspaper",show:n.value},{to:"/register",text:"註冊",icon:"mdi-account-plus",show:!n.value},{to:"/login",text:"登入",icon:"mdi-login",show:!n.value}]),c=async()=>{try{await j.delete("/users/logout"),t.logout(),l({text:"登出成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),v.push("/")}catch(o){console.log(o),l({text:o.message.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red ",location:"bottom"}})}},V=async()=>{try{const{data:o}=await j.get("conversation/latest");return o.result._id}catch(o){return console.error("Error fetching the latest conversation ID: ",o),null}},f=async()=>{const o=await V();console.log(o),o?v.push(`/conversation/${o}`):(l({text:"您目前尚無創建對話話題，請從探索話題開始選擇話題",showCloseButton:!1,snackbarProps:{timeout:5e3,color:"red",location:"bottom"}}),console.error("Failed to navigate to the latest conversation due to missing ID."))};return(o,h)=>{const x=Ce("router-view");return d(),B(w,null,[a($e,{color:"#fff"},{default:i(()=>[a(P,{active:!1,to:"/"},{default:i(()=>[a(qe,{class:"web-title"},{default:i(()=>[k("E-Friend ")]),_:1})]),_:1}),je,a(Ie),g.value?(d(),S(Oe,{key:0,onClick:h[0]||(h[0]=r=>p.value=!p.value)})):_("",!0),g.value?_("",!0):(d(),B(w,{key:1},[(d(!0),B(w,null,Y(y.value,r=>(d(),B(w,{key:r.to},[r.show?(d(),S(P,{key:0,active:!1,to:r.to,"prepend-icon":r.icon},{default:i(()=>[k(G(r.text),1)]),_:2},1032,["to","prepend-icon"])):_("",!0)],64))),128)),I(n)?(d(),B(w,{key:0},[a(P,{"prepend-icon":"mdi-forum",onClick:f},{default:i(()=>[k("我的對話")]),_:1}),I(s)?(d(),S(P,{key:0,"prepend-icon":"mdi-cog",to:"/admin"},{default:i(()=>[k("管理")]),_:1})):_("",!0),a(P,{"prepend-icon":"mdi-logout",onClick:c},{default:i(()=>[k("登出")]),_:1})],64)):_("",!0)],64))]),_:1}),g.value?(d(),S(Re,{key:0,modelValue:p.value,"onUpdate:modelValue":h[1]||(h[1]=r=>p.value=r),location:"right",temporary:""},{default:i(()=>[a(Pe,null,{default:i(()=>[(d(!0),B(w,null,Y(y.value,r=>(d(),B(w,{key:r.to},[r.show?(d(),S(F,{key:0,to:r.to},{prepend:i(()=>[a(M,{icon:r.icon},null,8,["icon"]),a(U,null,{default:i(()=>[k(G(r.text),1)]),_:2},1024)]),_:2},1032,["to"])):_("",!0)],64))),128)),I(n)?(d(),S(F,{key:0,onClick:f},{prepend:i(()=>[a(M,{icon:"mdi-forum"}),a(U,null,{default:i(()=>[k("我的對話")]),_:1})]),_:1})):_("",!0),I(n)&&I(s)?(d(),S(F,{key:1,to:"/admin"},{prepend:i(()=>[a(M,{icon:"mdi-cog"}),a(U,null,{default:i(()=>[k("管理")]),_:1})]),_:1})):_("",!0),I(n)?(d(),S(F,{key:2,onClick:c},{prepend:i(()=>[a(M,{icon:"mdi-logout"}),a(U,null,{default:i(()=>[k("登出")]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1},8,["modelValue"])):_("",!0),a(He,null,{default:i(()=>[a(x)]),_:1})],64)}}},We=Ee(Ge,[["__scopeId","data-v-d8551667"]]);export{We as default};
