import{p as O,b0 as Q,am as ee,b1 as ae,g as te,D as le,b2 as oe,b3 as se,o as re,u as ne,b4 as ue,b5 as q,az as z,c as a,H as L,P as ie,x as n,a5 as D,R as E,S as M,T as ce,U as l,a9 as de,Y as me,aa as pe,K as w,Z as P,V as ge,W as H,X as K,a0 as s,ac as ve,ad as fe,b6 as be,a6 as Ve,ae as W,af as ke,b7 as xe,ag as ye,_ as he,a2 as X,ai as _e,aj as Ce,ab as we}from"./index-5ef22765.js";import{c as Pe,a as $,e as Se,u as Fe,d as S}from"./index.esm-8b326ff9.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{V as Be}from"./VContainer-9f0dd1f1.js";import{V as Ue,a as Y}from"./VRow-a3a9bb8c.js";import{V as Te}from"./VForm-27902817.js";import{V as Ae}from"./VTextarea-b4846ec8.js";import"./_commonjsHelpers-39b5b250.js";const De=O({...Q(),...ee(ae(),["inline"])},"VCheckbox"),Me=te()({name:"VCheckbox",inheritAttrs:!1,props:De(),emits:{"update:modelValue":r=>!0,"update:focused":r=>!0},setup(r,d){let{attrs:f,slots:m}=d;const u=le(r,"modelValue"),{isFocused:F,focus:b,blur:y}=oe(r),I=se(),p=re(()=>r.id||`checkbox-${I}`);return ne(()=>{const[B,c]=ue(f),[i,R]=q.filterProps(r),[h,U]=z.filterProps(r);return a(q,L({class:["v-checkbox",r.class]},B,i,{modelValue:u.value,"onUpdate:modelValue":V=>u.value=V,id:p.value,focused:F.value,style:r.style}),{...m,default:V=>{let{id:T,messagesId:k,isDisabled:A,isReadonly:g}=V;return a(z,L(h,{id:T.value,"aria-describedby":k.value,disabled:A.value,readonly:g.value},c,{modelValue:u.value,"onUpdate:modelValue":v=>u.value=v,onFocus:b,onBlur:y}),m)}})}),{}}});const $e=r=>(_e("data-v-f91bac20"),r=r(),Ce(),r),Re=$e(()=>we("h1",{class:"text-center"},"話題管理",-1)),je={__name:"TopicView",setup(r){const d=ie(),f=n(10),m=n(1),u=n([]),F=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"話題名稱",align:"center",sortable:!1,key:"topic"},{title:"Prompt內文",align:"center",sortable:!1,key:"content"},{title:"分類",align:"center",sortable:!1,key:"category"},{title:"話題啟用",align:"center",sortable:!1,key:"active"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],b=n(!1),y=n(0),I=n(""),p=async()=>{var o;b.value=!0;try{const{data:e}=await D.get("/prompts/all",{params:{page:m.value,itemsPerPage:f.value}});console.log("管理表單頁面，成功獲得all prompt到前端"),u.value.splice(0,u.value.length,...e.result),y.value=e.result.length}catch(e){d({text:((o=e.response)==null?void 0:o.data.message)||"發生錯誤",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}b.value=!1};p();const B=o=>{i.value=o._id,g.value.value=o.topic,v.value.value=o.content,_.value.value=o.category,C.value.value=o.active,c.value=!0},c=n(!1),i=n(""),R=()=>{i.value="",c.value=!0},h=()=>{c.value=!1,A(),N.value.deleteFileRecord()},U=["日常話題","興趣話題","旅遊話題","職場話題","考試口說","情境話題"],V=Pe({topic:$().required("缺少名稱"),content:$().required("缺少prompt內容"),category:$().required("缺少分類").test("isCategory",o=>U.includes(o)),active:Se()}),{handleSubmit:T,isSubmitting:k,resetForm:A}=Fe({validationSchema:V,initialValues:{topic:"",content:"",category:"",active:!1}}),g=S("topic"),v=S("content"),_=S("category"),C=S("active"),x=n([]),j=n([]),N=n(null),Z=T(async o=>{if(!(i.value.length===0&&x.value.length===0))try{const e=new FormData;e.append("topic",o.topic),e.append("content",o.content),e.append("category",o.category),e.append("active",o.active),x.value.length>0&&e.append("image",x.value[0].file),i.value.length>0?(console.log("開始修改prompt(前端)"),await D.patch("/prompts/"+i.value,e),d({text:"修改prompt成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})):(console.log("開始新增prompt (前端)"),await D.post("/prompts",e),d({text:"新增prompt成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})),h(),p()}catch(e){console.log(e),d({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(o,e)=>{const G=E("VDataTableServer"),J=E("VueFileAgent");return M(),ce(me,null,[a(Be,null,{default:l(()=>[a(Ue,null,{default:l(()=>[a(Y,{cols:"12"},{default:l(()=>[Re]),_:1}),a(pe),a(Y,{cols:"12"},{default:l(()=>[a(w,{color:"green",onClick:R},{default:l(()=>[P("新增話題")]),_:1}),a(G,{"items-per-page":f.value,"onUpdate:itemsPerPage":[e[0]||(e[0]=t=>f.value=t),p],page:m.value,"onUpdate:page":[e[1]||(e[1]=t=>m.value=t),p],items:u.value,headers:F,loading:b.value,"items-length":y.value,search:I.value,hover:""},{top:l(()=>[]),"item.image":l(({item:t})=>[a(ge,{src:t.raw.image,height:"50px"},null,8,["src"])]),"item.active":l(({item:t})=>[t.raw.active?(M(),H(X,{key:0,icon:"mdi-check"})):K("",!0),t.raw.active?K("",!0):(M(),H(X,{key:1,icon:"mdi-close"}))]),"item.edit":l(({item:t})=>[a(w,{icon:"mdi-pencil",onClick:Ne=>B(t.raw),variant:"text"},null,8,["onClick"])]),_:2},1032,["items-per-page","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),a(de,{class:"dialog",persistent:"",width:"500px",modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value=t),scrollable:""},{default:l(()=>[a(Te,{disabled:s(k),onSubmit:ve(s(Z),["prevent"])},{default:l(()=>[a(fe,null,{default:l(()=>[a(be,null,{default:l(()=>[P(Ve(i.value.length>0?"編輯話題":"新增話題"),1)]),_:1}),a(W,null,{default:l(()=>[a(ke,{label:"名稱",modelValue:s(g).value.value,"onUpdate:modelValue":e[2]||(e[2]=t=>s(g).value.value=t),"error-messages":s(g).errorMessage.value},null,8,["modelValue","error-messages"]),a(Ae,{label:"Prompt內文",modelValue:s(v).value.value,"onUpdate:modelValue":e[3]||(e[3]=t=>s(v).value.value=t),"error-messages":s(v).errorMessage.value},null,8,["modelValue","error-messages"]),a(J,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t),"raw-model-value":j.value,"onUpdate:rawModelValue":e[5]||(e[5]=t=>j.value=t),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:N},null,8,["modelValue","raw-model-value"]),a(W,{class:"d-flex justify-end padding-0"},{default:l(()=>[a(xe,{label:"分類",modelValue:s(_).value.value,"onUpdate:modelValue":e[6]||(e[6]=t=>s(_).value.value=t),"error-messages":s(_).errorMessage.value,items:U},null,8,["modelValue","error-messages"]),a(Me,{label:"啟用話題",modelValue:s(C).value.value,"onUpdate:modelValue":e[7]||(e[7]=t=>s(C).value.value=t),"error-messages":s(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(ye,null,{default:l(()=>[a(he),a(w,{color:"red",onClick:h,loading:s(k)},{default:l(()=>[P("取消")]),_:1},8,["loading"]),a(w,{color:"green",type:"submit",loading:s(k)},{default:l(()=>[P("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}},Ye=Ie(je,[["__scopeId","data-v-f91bac20"]]);export{Ye as default};
